!function(a){a.fn.smartTruncation=function(b){var c=a.merge(b||{},{protectExtensions:!1,truncateCenter:!1});return a(this).each(function(){var b=a(this);a(window).data("smarttruncation.sizecache")||a(window).data("smarttruncation.sizecache",{});var d={fontSize:b.css("fontSize"),fontFamily:b.css("fontFamily"),fontWeight:b.css("fontWeight"),fontStyle:b.css("fontStyle")},e=function(a){var b="";for(b in a)b+=a[b];return b}(d),f={};if(a(window).data("smarttruncation.sizecache")[e])f=a(window).data("smarttruncation.sizecache")[e];else{var g="a b c d e f g h i j k l m n o p q r s t u v w x y z".split(" "),h="1 2 3 4 5 6 7 8 9 0".split(" "),i="! ยง $ % & / ( ) = ? @ * ' + # - ; , : . < >".split(" "),j=g.concat([" ",'"',"'"]).concat(h).concat(i).concat(a.map(g,function(a){return a.toUpperCase()})),k=a("<span/>").css(a.extend({visibility:"hidden"},d)).appendTo("body");a.each(j,function(a,b){f[b]=k.text(b).width()}),k.remove(),a(window).data("smarttruncation.sizecache")[e]=f}var l=b.wrapInner("<span/>",{"class":"smarttruncation-wrapper"}).find("span").css({whiteSpace:"nowrap"}),m=a.trim(l.text()),n=l.width(),o=parseInt(b.css("letterSpacing"),10)||-1,p="",q=m;if(c.protectExtensions){var r=m.split(".");p=r.pop(),q=r.join(".")}var s=function(){var e,g=b.width()-n-3*f["."];if(0>=g){var h=q.split("");if(c.truncateCenter){for(var i=h.slice(0,Math.floor(h.length/2)),j=h,k=i.length,r=j.length;0>=g;){var s=k>r?i[--k]:i[--r];g=g+(f[s]||f.h)+o}if(l.text(a.trim(i.slice(0,k).join(""))+"..."+a.trim(j.slice(j.length-r).join(""))+p),l.width()>b.width())for(;l.width()>b.width();)k>r?k--:r--,l.text(a.trim(i.slice(0,k).join(""))+"..."+a.trim(j.slice(j.length-r).join(""))+p);else if(e=.4*parseInt(d.fontSize,10),l.width()+e<b.width())for(;l.width()+e<b.width();)r>k?k++:r++,l.text(a.trim(i.slice(0,k).join(""))+"..."+a.trim(j.slice(j.length-r).join(""))+p)}else{for(var t=h.length;0>=g;)g=g+(f[--t]||f.h)+o/2;if(l.text(a.trim(h.slice(0,t).join(""))+"..."+p),l.width()>b.width())for(;l.width()>b.width();)l.text(a.trim(h.slice(0,--t).join(""))+"..."+p);else if(e=.4*parseInt(d.fontSize,10),l.width()+e<b.width())for(;l.width()+e<b.width();)l.text(a.trim(h.slice(0,++t).join(""))+"..."+p)}}else l.text(m)};a(window).bind("resize.smarttruncation",function(){s()}),s()})}}(jQuery);